{"version":3,"file":"DepositButton.js","sources":["../../../src/earn/components/DepositButton.tsx"],"sourcesContent":["'use client';\nimport { useDepositAnalytics } from '@/earn/hooks/useDepositAnalytics';\nimport { cn } from '@/styles/theme';\nimport {\n  type LifecycleStatus,\n  Transaction,\n  TransactionButton,\n  type TransactionResponse,\n} from '@/transaction';\nimport { ConnectWallet } from '@/wallet';\nimport { useCallback, useState } from 'react';\nimport type { DepositButtonReact } from '../types';\nimport { useEarnContext } from './EarnProvider';\n\nexport function DepositButton({ className }: DepositButtonReact) {\n  const {\n    recipientAddress: address,\n    vaultToken,\n    depositCalls,\n    depositAmount,\n    setDepositAmount,\n    depositAmountError,\n    updateLifecycleStatus,\n    refetchWalletBalance,\n    isSponsored,\n  } = useEarnContext();\n  const [depositedAmount, setDepositedAmount] = useState('');\n  const { setTransactionState } = useDepositAnalytics(depositedAmount);\n\n  const handleOnStatus = useCallback(\n    (status: LifecycleStatus) => {\n      setTransactionState(status.statusName);\n\n      if (status.statusName === 'transactionPending') {\n        updateLifecycleStatus({ statusName: 'transactionPending' });\n      }\n\n      if (\n        status.statusName === 'transactionLegacyExecuted' ||\n        status.statusName === 'success' ||\n        status.statusName === 'error'\n      ) {\n        updateLifecycleStatus(status);\n      }\n    },\n    [updateLifecycleStatus, setTransactionState],\n  );\n\n  const handleOnSuccess = useCallback(\n    (res: TransactionResponse) => {\n      if (\n        res.transactionReceipts[0] &&\n        res.transactionReceipts[0].status === 'success'\n      ) {\n        // Don't overwrite to '' when the second txn comes in\n        if (depositAmount) {\n          setDepositedAmount(depositAmount);\n        }\n        setDepositAmount('');\n        refetchWalletBalance();\n      }\n    },\n    [depositAmount, setDepositAmount, refetchWalletBalance],\n  );\n\n  if (!address) {\n    return (\n      <ConnectWallet\n        className={cn('w-full', className)}\n        text=\"Connect to deposit\"\n      />\n    );\n  }\n\n  return (\n    <Transaction\n      className={className}\n      calls={depositCalls}\n      onStatus={handleOnStatus}\n      onSuccess={handleOnSuccess}\n      isSponsored={isSponsored}\n      resetAfter={3_000}\n    >\n      <TransactionButton\n        text={depositAmountError ?? 'Deposit'}\n        successOverride={{\n          text: `Deposited ${depositedAmount} ${vaultToken?.symbol}`,\n        }}\n        disabled={!!depositAmountError || !depositAmount}\n      />\n    </Transaction>\n  );\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAcO,SAAS,cAAc,EAAE,aAAiC;AAC/D,QAAM;AAAA,IACJ,kBAAkB;AAAA,IAClB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACE,eAAA;AACJ,QAAM,CAAC,iBAAiB,kBAAkB,IAAI,SAAS,EAAE;AACzD,QAAM,EAAE,oBAAA,IAAwB,oBAAoB,eAAe;AAEnE,QAAM,iBAAiB;AAAA,IACrB,CAAC,WAA4B;AAC3B,0BAAoB,OAAO,UAAU;AAErC,UAAI,OAAO,eAAe,sBAAsB;AAC9C,8BAAsB,EAAE,YAAY,sBAAsB;AAAA,MAC5D;AAEA,UACE,OAAO,eAAe,+BACtB,OAAO,eAAe,aACtB,OAAO,eAAe,SACtB;AACA,8BAAsB,MAAM;AAAA,MAC9B;AAAA,IACF;AAAA,IACA,CAAC,uBAAuB,mBAAmB;AAAA,EAAA;AAG7C,QAAM,kBAAkB;AAAA,IACtB,CAAC,QAA6B;AAC5B,UACE,IAAI,oBAAoB,CAAC,KACzB,IAAI,oBAAoB,CAAC,EAAE,WAAW,WACtC;AAEA,YAAI,eAAe;AACjB,6BAAmB,aAAa;AAAA,QAClC;AACA,yBAAiB,EAAE;AACnB,6BAAA;AAAA,MACF;AAAA,IACF;AAAA,IACA,CAAC,eAAe,kBAAkB,oBAAoB;AAAA,EAAA;AAGxD,MAAI,CAAC,SAAS;AACZ,WACE;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,WAAW,GAAG,UAAU,SAAS;AAAA,QACjC,MAAK;AAAA,MAAA;AAAA,MAFP;AAAA,MAAA;AAAA,MAAA;AAAA,QAAA,UAAA;AAAA,QAAA,YAAA;AAAA,QAAA,cAAA;AAAA,MAAA;AAAA,MAAA;AAAA,IAAA;AAAA,EAKJ;AAEA,SACE;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA,OAAO;AAAA,MACP,UAAU;AAAA,MACV,WAAW;AAAA,MACX;AAAA,MACA,YAAY;AAAA,MAEZ,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAM,sBAAsB;AAAA,UAC5B,iBAAiB;AAAA,YACf,MAAM,aAAa,eAAe,IAAI,yCAAY,MAAM;AAAA,UAAA;AAAA,UAE1D,UAAU,CAAC,CAAC,sBAAsB,CAAC;AAAA,QAAA;AAAA,QALrC;AAAA,QAAA;AAAA,QAAA;AAAA,UAAA,UAAA;AAAA,UAAA,YAAA;AAAA,UAAA,cAAA;AAAA,QAAA;AAAA,QAAA;AAAA,MAAA;AAAA,IAMA;AAAA,IAdF;AAAA,IAAA;AAAA,IAAA;AAAA,MAAA,UAAA;AAAA,MAAA,YAAA;AAAA,MAAA,cAAA;AAAA,IAAA;AAAA,IAAA;AAAA,EAAA;AAiBJ;"}