{"version":3,"file":"BuyDropdown.js","sources":["../../../src/buy/components/BuyDropdown.tsx"],"sourcesContent":["'use client';\nimport { useAnalytics } from '@/core/analytics/hooks/useAnalytics';\nimport { BuyEvent, type BuyOption } from '@/core/analytics/types';\nimport { openPopup } from '@/internal/utils/openPopup';\nimport { useOnchainKit } from '@/useOnchainKit';\nimport { useCallback, useEffect, useMemo } from 'react';\nimport { useAccount } from 'wagmi';\nimport { ONRAMP_BUY_URL } from '../../fund/constants';\nimport { getFundingPopupSize } from '../../fund/utils/getFundingPopupSize';\nimport { getRoundedAmount } from '../../internal/utils/getRoundedAmount';\nimport { background, border, cn, color, text } from '../../styles/theme';\nimport { ONRAMP_PAYMENT_METHODS } from '../constants';\nimport { isApplePaySupported } from '../utils/isApplePaySupported';\nimport { BuyOnrampItem } from './BuyOnrampItem';\nimport { useBuyContext } from './BuyProvider';\nimport { BuyTokenItem } from './BuyTokenItem';\n\n// eslint-disable-next-line complexity\nexport function BuyDropdown() {\n  const { projectId } = useOnchainKit();\n  const { to, fromETH, fromUSDC, from, startPopupMonitor, setIsDropdownOpen } =\n    useBuyContext();\n  const { address } = useAccount();\n  const { sendAnalytics } = useAnalytics();\n\n  const handleOnrampClick = useCallback(\n    (paymentMethodId: string) => {\n      return () => {\n        sendAnalytics(BuyEvent.BuyOptionSelected, {\n          option: paymentMethodId as BuyOption,\n        });\n\n        const assetSymbol = to?.token?.symbol;\n        let fundAmount = to?.amount;\n        // funding url requires a leading zero if the amount is less than 1\n        if (fundAmount?.[0] === '.') {\n          fundAmount = `0${fundAmount}`;\n        }\n        const fundingUrl = `${ONRAMP_BUY_URL}/one-click?appId=${projectId}&addresses={\"${address}\":[\"base\"]}&assets=[\"${assetSymbol}\"]&presetCryptoAmount=${fundAmount}&defaultPaymentMethod=${paymentMethodId}`;\n        const { height, width } = getFundingPopupSize('md', fundingUrl);\n        const popupWindow = openPopup({\n          url: fundingUrl,\n          height,\n          width,\n          target: '_blank',\n        });\n\n        if (popupWindow) {\n          // Detects when the popup is closed\n          // to stop loading state\n          startPopupMonitor(popupWindow);\n        }\n      };\n    },\n    [address, to, projectId, startPopupMonitor, sendAnalytics],\n  );\n\n  const formattedAmountUSD = useMemo(() => {\n    if (!to?.amountUSD || to?.amountUSD === '0') {\n      return null;\n    }\n    const roundedAmount = Number(getRoundedAmount(to?.amountUSD, 2));\n    return `$${roundedAmount.toFixed(2)}`;\n  }, [to?.amountUSD]);\n\n  const isToETH = to?.token?.symbol === 'ETH';\n  const isToUSDC = to?.token?.symbol === 'USDC';\n  const showFromToken =\n    to?.token?.symbol !== from?.token?.symbol &&\n    from &&\n    from?.token?.symbol !== 'ETH' &&\n    from?.token?.symbol !== 'USDC';\n\n  useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        setIsDropdownOpen(false);\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown);\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [setIsDropdownOpen]);\n\n  const isApplePayEnabled = isApplePaySupported();\n\n  return (\n    <div\n      className={cn(\n        color.foreground,\n        background.default,\n        'absolute right-0 bottom-0 flex translate-y-[102%] flex-col gap-2',\n        'z-10 min-w-80 rounded border p-2',\n        border.radius,\n      )}\n    >\n      <div className={cn(text.headline, 'px-2 pt-2')}>Buy with</div>\n      {!isToETH && <BuyTokenItem swapUnit={fromETH} />}\n      {!isToUSDC && <BuyTokenItem swapUnit={fromUSDC} />}\n      {showFromToken && <BuyTokenItem swapUnit={from} />}\n\n      {ONRAMP_PAYMENT_METHODS.map((method) => {\n        if (method.id === 'APPLE_PAY' && !isApplePayEnabled) {\n          return null;\n        }\n        return (\n          <BuyOnrampItem\n            key={method.id}\n            name={method.name}\n            description={method.description}\n            onClick={handleOnrampClick(method.id)}\n            icon={method.icon}\n            to={to}\n          />\n        );\n      })}\n\n      {!!formattedAmountUSD && (\n        <div\n          className={cn('flex justify-end', text.legal, color.foregroundMuted)}\n        >{`${to?.amount} ${to?.token?.name} â‰ˆ ${formattedAmountUSD}`}</div>\n      )}\n    </div>\n  );\n}\n"],"names":["_a"],"mappings":"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"}